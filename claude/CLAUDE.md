日本語で返答して。

## 言語使用規則

### ユーザー向け (英語で記述)

- UIテキスト（ラベル、ボタン、メニュー）
- エラーメッセージ
- ログメッセージ

### 開発者向け (日本語で記述)

- コードコメント・JSDoc
- テストコード・説明
- 技術文書

### ドキュメント規約

- 図・フローチャートは Mermaid 記法を使用する

## コーディング原則

### 優先順位

1. ドメイン適合性: ドメインモデルや実態に沿った設計を最優先
2. 整合性: 既存コードベースのパターン・アーキテクチャとの一貫性
3. 破壊的変更の許容: 部分的パッチより、根本的な改善を優先
4. YAGNI/DRY/KISS: 上記を満たした上で適用

### 実装方針

- 簡素化より正しい抽象化を選ぶ
- 既存コードが不適切ならリファクタリングを提案する
- 「シンプルにできる」より「ドメインを正しく表現できる」を重視
- 破壊的変更が必要な場合は、その理由と影響範囲を説明した上で実装

### ボーイスカウトルール

**原則**: 編集したコードの周辺を、着手前よりも綺麗な状態にする

**改善対象の範囲**:
- 編集したファイル内の関連コード
- インポート元のファイル（変更に関連する箇所）

**許容する改善**:
- 型の厳密化（`any` → 適切な型）
- 不要な変数・インポートの削除
- 命名の改善（より意図が伝わる名前へ）
- 早期リターンへの変換
- マジックナンバーの定数化
- 軽微なコードスタイルの統一

**禁止する改善**:
- タスクと無関係なファイルへの変更
- 大規模なリファクタリング（別タスクとして提案）
- 動作に影響を与える可能性のある変更

**報告**: 改善した箇所は完了時に簡潔に報告する

## コーディング規約

### TypeScript/JavaScript 一般

- `any`型禁止 → `unknown`型や適切な型定義を使用
- `interface`より`type`を優先 → 予期しないプロパティの追加を防ぐため
- optional chaining（`?.`）とnullish coalescing（`??`）の積極活用
- ジェネリック型・ユニオン型を活用して型安全性を保持
- デバッグ用のログ表示は `console.debug` を使用
- 早期リターンは `if (...) { return; }` ではなく `if (...) return;` の1行形式を使用する

### Svelte 5 Runes 規約

- 派生値の計算は getter ではなく `$derived` / `$derived.by` を使用する
- リアクティブな Map/Set は `$state(new Map/Set)` ではなく `SvelteMap` / `SvelteSet` を直接使用する
- TSファイル内で Rune を使用する場合、ファイル名は `.svelte.ts` にする

## ツール使用規則

- `grep` ではなく `rg`（ripgrep）を使用する
- `find` ではなく `fd` を使用する
